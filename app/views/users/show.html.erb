<div class="container">

  <ul class="nav nav-tabs" id="myTab" role="tablist">
    <li class="nav-item" role="presentation">
      <a style="color: #147ffb" class="nav-link active" id="home-tab" data-toggle="tab" href="#home" role="tab" aria-controls="home" aria-selected="true">My Bookings</a>
    </li>
    <li class="nav-item" role="presentation">
      <a style="color: #147ffb" class="nav-link" id="profile-tab" data-toggle="tab" href="#profile" role="tab" aria-controls="profile" aria-selected="false">My Campsites</a>
    </li>
    <li class="nav-item" role="presentation">
      <a style="color: #147ffb" class="nav-link" id="contact-tab" data-toggle="tab" href="#contact" role="tab" aria-controls="contact" aria-selected="false">My Campsites bookings</a>
    </li>
  </ul>

  <div class="tab-content" id="myTabContent">
    <div class="tab-pane fade show active" id="home" role="tabpanel" aria-labelledby="home-tab">
      <% @bookings.each_with_index do |booking, index| %>
        <div class="col-sm-6 mb-5">
          <div class="card mb-3 p-0 border-radius-card">
            <div class="row g-0">
              <div class="col-md-5 mb-0 align-items-center">
                <% if booking.campsite.photo.attached? %>
                  <%= cl_image_tag booking.campsite.photo.key, crop: :fill, class: "card-img-top" %>
                <% else %>
                  <%= image_tag "https://images.unsplash.com/photo-1504280390367-361c6d9f38f4?ixid=MnwxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8&ixlib=rb-1.2.1&auto=format&fit=crop&w=3300&q=80", alt: "Card image cap", width: 200, class: "card-img-top" %>
                <% end %>
              </div>
              <div class="col-md-7">
                <div class="card-body mt-2 p-0 mb-0 ml-0">
                  <%= link_to campsite_path(booking.campsite.id) do %>
                  <h5 class="card-title d-flex justify-content-between mb-1 pb-0"><%= booking.campsite.name %></h5>
                  <% end %>
                  <p class="card-text mb-1 p-0"><small class="text-muted"><i class="fas fa-user-friends"></i>&nbsp;
                  <%= booking.number_of_guest %> </small>
                  <small class="text-muted ml-2">
                  Status: <% if booking.status.nil? %>
                  Pending
                  <% elsif booking.status == true %>
                    Confirmed
                  <% elsif booking.status == false %>
                    Declined
                  <% end %></small></p>
                </div>
                <div class="border-bottom-p">
                </div>
                <p class="card-text mb-1 p-0"><small class="text-muted">From: <%= booking.start_date.strftime("%A, %b %d") %></small></p>
                <p class="card-text mb-1 p-0"><small class="text-muted">To: <%= booking.end_date.strftime("%A, %b %d") %></small></p>
                <p class="card-text mb-1 p-0"><small class="text-muted">Number of Nights: <%= (booking.end_date - booking.start_date).to_i %></small></p>
                <% unless booking.review.nil? %>
                  <p class="text-muted" >
                    review: <%= booking.review.rating %>
                  </p>
                <% else %>
                  <%= simple_form_for([booking, @review], html: { class: "review_form_#{index}" }) do |f| %>
                    <%= f.input :rating, as: :select, collection: (1..5).to_a, label: "Rate your experience", input_html:{id: "review_rating_#{index}", class: "review_rating"} %>
                  <% end %>
                <% end %>
                <div class="card-body d-flex align-items-end ml-0 absolute-position">
                  <h5 class="m-0">Â£<%= booking.total_price %>0</h5>
                </div>
                <div class="card-body">
                </div>
              </div>
            </div>
          </div>
        </div>
      <% end %>
    </div>

    <div class="tab-pane fade" id="profile" role="tabpanel" aria-labelledby="profile-tab">
      <% @campsites.each do |campsite| %>
        <div class="col-sm-4 mb-5">
          <div class="card">
              <% if campsite.photo.attached? %>
                <%= cl_image_tag campsite.photo.key, crop: :fill, class: "card-img-top" %>
              <% else %>
                <%= image_tag "https://images.unsplash.com/photo-1504280390367-361c6d9f38f4?ixid=MnwxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8&ixlib=rb-1.2.1&auto=format&fit=crop&w=3300&q=80", alt: "Card image cap", width: 200, class: "card-img-top" %>
              <% end %>
            <div class="card-body" style="color:black">
              <h4><%= campsite.name %></h4>
              <h5>Address:</h5>
              <p><%= campsite.address %></p>
            </div>
          </div>
        </div>
      <% end %>
    </div>

    <div class="tab-pane fade" id="contact" role="tabpanel" aria-labelledby="contact-tab">
      <% @my_campsites_bookings.each do |campsite_booking| %>
        <div class="col-sm-4 mb-5">
          <div class="card">
            <% if campsite_booking.campsite.photo.attached? %>
              <%= cl_image_tag campsite_booking.campsite.photo.key, crop: :fill, class: "card-img-top" %>
            <% else %>
              <%= image_tag "https://images.unsplash.com/photo-1504280390367-361c6d9f38f4?ixid=MnwxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8&ixlib=rb-1.2.1&auto=format&fit=crop&w=3300&q=80", alt: "Card image cap", width: 200, class: "card-img-top" %>
            <% end %>
            <div class="card-body" style="color:black">
              <h4><%= campsite_booking.campsite.name %></h4>
              <h5>Start date</h5>
              <p><%= campsite_booking.start_date %></p>
              <h5>End date</h5>
              <p><%= campsite_booking.end_date %></p>
              <p>Number of Nights:</p>
              <p><%= (campsite_booking.end_date - campsite_booking.start_date).to_i %></p>
              <h5>Total price</h5>
              <p><%= campsite_booking.total_price %></p>
              <h5>Number of guest</h5>
              <p><%= campsite_booking.number_of_guest %></p>
              <h5>Customer's email:</h5>
              <p> <%= campsite_booking.user.email %> </p>
              <h5>Status</h5>
              <% if campsite_booking.status.nil? %>
                <p>Pending</p>
                <%= link_to "confirm", booking_path(campsite_booking, confirmed: "true"), method: :patch %>
                <%= link_to "decline", booking_path(campsite_booking, confirmed: "false"), method: :patch %>
              <% elsif campsite_booking.status == true %>
                <p>Confirmed</p>
              <% elsif campsite_booking.status == false %>
                <p>Declined</p>
              <% end %>
            </div>
          </div>
        </div>
      <% end %>
    </div>
  </div>
</div>
